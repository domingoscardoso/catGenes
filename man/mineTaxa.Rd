% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/mineTaxa.R
\name{mineTaxa}
\alias{mineTaxa}
\title{Mine DNA sequences from GenBank using taxonomic queries}
\usage{
mineTaxa(term = NULL,
         db = "nucleotide",
         filename = "mined_seqs_by_taxon.fasta",
         clean_taxa = TRUE,
         add_voucher = TRUE,
         original_query = FALSE,
         plastome_apart = TRUE,
         rm_duplicated = TRUE,
         retmax = 4000,
         verbose = TRUE,
         save = TRUE,
         dir = "RESULTS_mineTaxa")
}
\arguments{
\item{term}{Character string specifying the search query for GenBank.
Should follow NCBI Entrez search syntax (e.g., "Solanaceae\[Organism\] AND matk",
"Arabidopsis\[Organism\] AND rbcL\[Gene\]"). See NCBI's
\href{https://www.ncbi.nlm.nih.gov/books/NBK3837/}{Entrez Help} for detailed syntax.}

\item{db}{Character string specifying the NCBI database to search.
Default is "nucleotide". Other options include "protein", "popset", etc.
See \code{\link[rentrez]{entrez_search}} for details.}

\item{filename}{Character string for the output FASTA file name.
Default is "mined_seqs_by_taxon.fasta".}

\item{clean_taxa}{Logical. If \code{TRUE} (default), taxon names are cleaned
and standardized (removes authors, subsp./var. indicators, special characters).
If \code{FALSE}, original GenBank names are preserved.}

\item{add_voucher}{Logical. If \code{TRUE} (default), voucher specimen information
(when available) is extracted and appended to sequence names in the format:
Genus_species_voucher_accession. If \code{FALSE}, voucher information is omitted.}

\item{original_query}{Logical. If \code{TRUE}, a copy of the original unprocessed
FASTA file is saved with "_ORIGINAL_QUERY" suffix. If \code{FALSE} (default),
only the cleaned file is kept. Ignored if \code{clean_taxa = FALSE}.}

\item{plastome_apart}{Logical. If \code{TRUE} (default), complete plastome sequences
are separated into a separate file with "PLASTOMES_" prefix. Useful for
distinguishing whole plastomes from individual gene sequences.}

\item{rm_duplicated}{Logical. If \code{TRUE} (default), removes duplicate sequences
from the same species, keeping only the longest sequence. Applied separately
to plastomes and other sequences.}

\item{retmax}{Numeric. Maximum number of sequences to retrieve from GenBank.
Default is 4000. Increase for large queries, but note NCBI rate limits.}

\item{verbose}{Logical. If \code{TRUE} (default), progress messages are printed
to the console. If \code{FALSE}, function runs silently.}

\item{save}{Logical. If \code{TRUE} (default), results are saved to disk in
the specified directory. If \code{FALSE}, results are returned as R objects
without saving.}

\item{dir}{Character string specifying the directory path for saving results.
Default is "RESULTS_mineTaxa". A subdirectory with current date will be created
within this directory.}
}
\value{
If \code{save = TRUE}, returns an invisible list of DNA sequences in
\code{DNAbin} format (if \code{clean_taxa = TRUE}) or raw FASTA text (if
\code{clean_taxa = FALSE}). If \code{save = FALSE}, returns the processed
sequences as an R object. Files are written to disk in either case when
\code{save = TRUE}.
}
\description{
A comprehensive function built on the \href{https://docs.ropensci.org/rentrez/}{rentrez}
package to search, download, and process DNA sequences from GenBank using
taxonomic query terms. This function performs multiple operations including
taxon name cleaning, voucher information extraction, duplicate removal,
and plastome separation. It iss particularly useful for phylogenetic studies
requiring large-scale sequence retrieval with consistent naming conventions.
}
\details{
The function performs the following steps:
\enumerate{
\item Connects to GenBank using the specified search term
\item Downloads sequences (up to \code{retmax} records)
\item If \code{clean_taxa = TRUE}:
\itemize{
\item Extracts and cleans organism names from each accession
\item Optionally adds voucher information
\item Standardizes naming format: Genus_species_voucher_accession
\item Separates plastomes if \code{plastome_apart = TRUE}
\item Removes duplicates if \code{rm_duplicated = TRUE}
}
\item Saves results to specified directory with date-stamped subfolder
}

Taxon name cleaning includes:
\itemize{
\item Removing periods and hyphens
\item Converting "var.", "subsp.", "f." to simple spaces
\item Converting spaces to underscores
\item Trimming "sp." designations
\item Removing trailing underscores
\item Handling hybrid cultivars
}
}
\note{
\itemize{
\item Large queries may take considerable time due to NCBI rate limiting
\item Voucher extraction may not work for all GenBank entries (depends on annotation)
\item For very large datasets (>10,000 sequences), consider splitting queries
\item Always verify taxon name cleaning results for your specific taxonomic group
}
}
\examples{
\dontrun{
# Example 1: Basic search for matK sequences in Solanaceae (excluding Solanum)
result1 <- mineTaxa(
  term = "(Solanaceae[Organism] AND matk NOT Solanum[Organism])",
  filename = "Solanaceae_outSolanum.fasta"
)

# Example 2: Search for rbcL sequences in Fabaceae with custom settings
result2 <- mineTaxa(
  term = "Fabaceae[Organism] AND rbcL[Gene]",
  filename = "Fabaceae_rbcL.fasta",
  clean_taxa = TRUE,
  add_voucher = FALSE,          # Don't add voucher info
  original_query = TRUE,        # Keep original unprocessed file
  plastome_apart = FALSE,       # Don't separate plastomes
  rm_duplicated = FALSE,        # Keep all sequences
  retmax = 1000,
  verbose = TRUE
)

# Example 3: Protein database search
result3 <- mineTaxa(
  term = "Rubisco[Protein] AND plants[Organism]",
  db = "protein",
  filename = "plant_Rubisco.fasta",
  clean_taxa = FALSE           # Don't clean names for proteins
)

# Example 4: Return results without saving to disk
result4 <- mineTaxa(
  term = "Arabidopsis[Organism] AND chloroplast[Title]",
  verbose = FALSE,
  save = FALSE
)
}

}
\seealso{
\itemize{
\item \code{\link[rentrez]{entrez_search}} for NCBI search syntax
\item \code{\link[ape]{read.FASTA}} for FASTA file reading
\item \code{\link{minePlastome}} for targeted plastome mining
}
}
\author{
Domingos Cardoso
}
